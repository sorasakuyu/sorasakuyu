---
import EmptySvg from '@components/svg/EmptySvg';
import { contentConfig, defaultCoverList } from '@constants/site-config';
import type { Page } from 'astro';
import { shuffle } from 'es-toolkit';
import type { BlogPost, PostCardData } from 'types/blog';
import { getLocaleFromUrl, t } from '@/i18n';
import Paginator from './Paginator.astro';
import PostItemCard from './PostItemCard.astro';

interface Props {
  posts?: PostCardData[];
  page?: Page<BlogPost>;
  showPaginator?: boolean;
  baseUrl?: string; // 分页基础路径
  isHomePage?: boolean; // 是否是首页
  isSimple?: boolean; // 是否隐藏封面
}

const { posts, page, showPaginator = true, baseUrl, isHomePage = false, isSimple = false } = Astro.props;
const locale = getLocaleFromUrl(Astro.url.pathname);
const covers = shuffle(defaultCoverList);

const imagePosition = contentConfig.postCardImagePosition || 'alternating';
const isUniformPosition = imagePosition !== 'alternating';

/**
 * Calculate leftClip based on postCardImagePosition config
 * @param index - The index of the post in the list
 * @returns true if image should be on the left, false for right
 */
function getLeftClip(index: number): boolean {
  switch (imagePosition) {
    case 'left':
      return true;
    case 'right':
      return false;
    default:
      return index % 2 === 0;
  }
}
---

{
  !posts?.length && (
    <div class="text-foreground/30 flex flex-col items-center gap-2">
      <EmptySvg className="fill-foreground/20" />
      <span>{t(locale, 'post.noPostsFound')}</span>
    </div>
  )
}
{
  posts && posts?.length > 0 && (
    <>
      <div class="flex flex-col gap-4">
        {posts.map((post, index) => (
          <PostItemCard
            key={post.slug}
            data={post}
            showTags={!isSimple}
            leftClip={getLeftClip(index)}
            randomCover={covers[index % covers.length]}
            hideCover={isSimple}
            isSimple={isSimple}
            isUniformPosition={isUniformPosition}
          />
        ))}
      </div>
      {showPaginator && page && <Paginator page={page} baseUrl={baseUrl} isHomePage={isHomePage} />}
    </>
  )
}
