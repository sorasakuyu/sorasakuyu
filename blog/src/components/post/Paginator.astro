---
import { Button } from '@components/ui/button';
import type { Page } from 'astro';
import { FaChevronLeft, FaChevronRight } from 'react-icons/fa';
import type { BlogPost } from 'types/blog';
import { getLocaleFromUrl, localizedPath, t } from '@/i18n';

interface Props {
  page: Page<BlogPost>;
  baseUrl?: string; // 分页基础路径，默认为 '/posts'
  isHomePage?: boolean; // 是否是首页
}

const locale = getLocaleFromUrl(Astro.url.pathname);
const defaultBaseUrl = localizedPath('/posts', locale);
const { page, baseUrl = defaultBaseUrl, isHomePage = false } = Astro.props;

// 生成页面链接的辅助函数
const homeUrl = localizedPath('/', locale);
const getPageUrl = (pageNum: number) => {
  if (isHomePage) {
    return pageNum === 1 ? homeUrl : `${baseUrl}/${pageNum}`;
  }
  return pageNum === 1 ? baseUrl : `${baseUrl}/${pageNum}`;
};
---

<div class="flex-center gap-1 font-bold">
  {
    page.url.prev ? (
      <a href={page.url.prev} aria-label={t(locale, 'pagination.prev')}>
        <Button variant="ghost">
          <FaChevronLeft />
        </Button>
      </a>
    ) : (
      <Button variant="ghost" disabled aria-label={t(locale, 'pagination.prev')}>
        <FaChevronLeft />
      </Button>
    )
  }

  {
    page.currentPage !== 1 && page.currentPage - 1 !== 1 && (
      <a href={getPageUrl(1)} aria-label={t(locale, 'pagination.page', { page: 1 })}>
        <Button variant="ghost">1</Button>
      </a>
    )
  }
  {page.currentPage > 2 && <span class="mx-1">...</span>}
  {
    page.currentPage !== 1 && (
      <a href={getPageUrl(page.currentPage - 1)} aria-label={t(locale, 'pagination.page', { page: page.currentPage - 1 })}>
        <Button variant="ghost">{page.currentPage - 1}</Button>
      </a>
    )
  }

  <Button
    variant="ghost"
    disabled
    aria-current="page"
    aria-label={t(locale, 'pagination.currentPage', { page: page.currentPage })}
    className="text-primary disabled:opacity-100"
  >
    {page.currentPage}
  </Button>

  {
    page.currentPage !== page.lastPage && (
      <a href={getPageUrl(page.currentPage + 1)} aria-label={t(locale, 'pagination.page', { page: page.currentPage + 1 })}>
        <Button variant="ghost">{page.currentPage + 1}</Button>
      </a>
    )
  }
  {page.currentPage < page.lastPage - 2 && <span class="mx-1">...</span>}
  {
    page.currentPage !== page.lastPage && page.currentPage + 1 !== page.lastPage && (
      <a href={getPageUrl(page.lastPage)} aria-label={t(locale, 'pagination.page', { page: page.lastPage })}>
        <Button variant="ghost">{page.lastPage}</Button>
      </a>
    )
  }
  {
    page.url.next ? (
      <a href={page.url.next}>
        <Button variant="ghost">
          <FaChevronRight aria-label={t(locale, 'pagination.next')} />
        </Button>
      </a>
    ) : (
      <Button variant="ghost" disabled aria-label={t(locale, 'pagination.next')}>
        <FaChevronRight />
      </Button>
    )
  }
</div>
