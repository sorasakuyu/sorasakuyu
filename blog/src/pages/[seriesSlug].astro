---
import HomeSider from '@components/layout/HomeSider.astro';
import PostList from '@components/post/PostList.astro';
import SeriesCover from '@components/ui/cover/SeriesCover.astro';
import { CONTENT_PADDING } from '@constants/layout';
import { siteConfig } from '@constants/site-config';
import Layout from '@layouts/Layout.astro';
import TwoColumnLayout from '@layouts/TwoColumnLayout.astro';
import type { FeaturedSeriesItem } from '@lib/config/types';
import { getEnabledSeries, getPostsByCategory, translateSeriesField } from '@lib/content';
import { toPostCardDataList } from '@lib/content/transforms';
import type { GetStaticPaths } from 'astro';
import { getLocaleFromUrl, localizedPath, t } from '@/i18n';

export const getStaticPaths: GetStaticPaths = async () => {
  const enabledSeries = getEnabledSeries();

  return enabledSeries.map((series) => ({
    params: { seriesSlug: series.slug },
    props: { series },
  }));
};

interface Props {
  series: FeaturedSeriesItem;
}

const { series } = Astro.props;
const locale = getLocaleFromUrl(Astro.url.pathname);

// Get all posts for this series (transform to card data)
const seriesPosts = series.categoryName
  ? toPostCardDataList(await getPostsByCategory(series.categoryName, locale), locale)
  : [];

const seriesFullName = translateSeriesField(series.slug, 'fullName', series.fullName, locale);
const seriesLabel = translateSeriesField(series.slug, 'label', series.label, locale);
const pageTitle = seriesFullName || seriesLabel || series.categoryName;
---

<Layout title={`${pageTitle} | ${siteConfig.title}`} description={series.description?.slice(0, 160)}>
  <TwoColumnLayout>
    <SeriesCover slot="cover" series={series} />
    <HomeSider slot="sider" />
    <div class={`shadow-box bg-gradient-start mx-0 flex w-full flex-col ${CONTENT_PADDING.standard}`}>
      <h2 class="shoka-decoration-circle group relative h-19 px-6 py-5 text-2xl/9 font-bold md:text-xl/9">
        <a href={localizedPath('/', locale)} class="dashed-border text-muted-foreground group-hover:border-blue group-hover:text-blue border-b">{t(locale, 'nav.home')}</a>
        <span class="text-muted-foreground text-lg md:text-base"> / </span>
        {t(locale, 'post.totalPosts', { count: seriesPosts.length })}
      </h2>
      <PostList posts={seriesPosts} showPaginator={false} isSimple={true} />
    </div>
  </TwoColumnLayout>
</Layout>
