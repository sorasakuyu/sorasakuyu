---
import { CONTENT_PADDING } from '@constants/layout';
import { buildCategoryPath, type Category, translateCategoryName } from '@lib/content';
import { getLocaleFromUrl, localizedPath, t } from '@/i18n';
import CategoryTitle from './CategoryTitle.astro';
import SubCategory from './SubCategory.astro';

interface Props {
  categories: Category[];
  countMap: Record<string, number>;
  totalCount: number;
}
const { categories, countMap, totalCount } = Astro.props;
const locale = getLocaleFromUrl(Astro.url.pathname);
---

<div class={`shadow-box mx-0 flex w-full flex-col bg-gradient-start ${CONTENT_PADDING.standard}`}>
  <h2 class="shoka-decoration-circle group relative px-6 py-5 text-2xl/9 font-bold md:text-xl/9">
    <a href={localizedPath('/', locale)} class="dashed-border text-muted-foreground group-hover:border-blue group-hover:text-blue border-b"> {t(locale, 'nav.home')} </a>
    <span class="text-muted-foreground text-xl md:text-base">/</span> {t(locale, 'category.totalCategories', { count: totalCount })}
  </h2>

  <div class="flex w-full flex-col">
    {
      categories.map((category) => (
        <>
          <CategoryTitle
            title={translateCategoryName(category.name, locale)}
            count={countMap[category.name]}
            href={localizedPath(buildCategoryPath(category.name), locale)}
            className={category?.children?.length ? 'has-children' : ''}
          />
          {category?.children?.length && (
            <div class="category-first-level-container flex flex-col">
              {category?.children?.length &&
                category.children.map((child) => (
                  <SubCategory category={child} parentName={category.name} countMap={countMap} />
                ))}
            </div>
          )}
        </>
      ))
    }
  </div>
</div>
