---
import FooterAnnouncementEntry from '@components/announcement/FooterAnnouncementEntry';
import { MAX_WIDTH } from '@constants/layout';
import { siteConfig } from '@constants/site-config';
import { getSiteStats } from '@lib/stats';
import { cn } from '@lib/utils';
import { Icon } from 'astro-icon/components';
import { getLocaleFromUrl, t } from '@/i18n';
import SakuraSVG from '../svg/SakuraSvg';

interface Props {
  className?: string;
}

const { className } = Astro.props;

const locale = getLocaleFromUrl(Astro.url.pathname);
const stats = await getSiteStats();
const currentYear = new Date().getFullYear();
const startYear = siteConfig?.startYear ?? currentYear;
---

<footer class={cn('mt-auto pb-6', className)}>
  <div class={cn('mx-auto flex flex-col items-center gap-3 px-6 md:pb-10 md:px-3', MAX_WIDTH.content)}>
    <!-- Announcements Entry -->
    <FooterAnnouncementEntry client:load />

    <!-- Site Stats -->
    <div class="text-muted-foreground flex flex-wrap items-center justify-center gap-6 text-sm md:gap-4">
      <button class="flex items-center gap-2 opacity-75 transition-opacity duration-300 hover:opacity-100" title={t(locale, 'footer.totalWordsTitle')}>
        <Icon name="ri:file-text-line" class="h-4 w-4" />
        <span class="font-medium">{stats.formattedWords}</span>
        <span class="text-xs">{t(locale, 'footer.wordUnit')}</span>
      </button>

      <div class="bg-muted-foreground/30 h-4 w-px"></div>

      <button class="flex items-center gap-2 opacity-75 transition-opacity duration-300 hover:opacity-100" title={t(locale, 'footer.readingTimeTitle')}>
        <Icon name="ri:time-line" class="h-4 w-4" />
        <span class="font-medium">{stats.formattedTime}</span>
      </button>

      <div class="bg-muted-foreground/30 h-4 w-px"></div>

      <button class="flex items-center gap-2 opacity-75 transition-opacity duration-300 hover:opacity-100" title={t(locale, 'footer.postCountTitle')}>
        <Icon name="ri:article-line" class="h-4 w-4" />
        <span class="font-medium">{stats.postCount}</span>
        <span class="text-xs">{t(locale, 'footer.postUnit')}</span>
      </button>
    </div>

    <!-- Copyright -->
    <div class="text-muted-foreground flex items-center gap-0.5 text-sm">
      <span class="opacity-75">©</span>
      <span class="font-medium opacity-75">{startYear}</span>
      {
        startYear !== currentYear && (
          <>
            <span class="opacity-50">-</span>
            <span class="font-medium opacity-75" itemprop="copyrightYear">
              {currentYear}
            </span>
          </>
        )
      }
      <SakuraSVG className="mx-1 size-5 animate-spin text-[#FFC0CB] duration-10000" />
      <span class="author font-medium opacity-75" itemprop="copyrightHolder">
        {siteConfig.name}
        {siteConfig?.alternate ? `@${siteConfig.alternate}` : ''}
      </span>
    </div>

    <!-- Powered By -->
    <div class="text-muted-foreground/80 flex items-center gap-2 text-xs">
      <span class="opacity-75">Powered by theme</span>
      <a
        href="https://github.com/cosZone/astro-koharu"
        target="_blank"
        class="footer-link font-medium transition-all duration-300"
      >
        astro-koharu
      </a>
      <span class="opacity-50">·</span>
      <span class="opacity-75">Inspired by</span>
      <a
        href="https://github.com/amehime/hexo-theme-shoka"
        target="_blank"
        class="footer-link font-medium transition-all duration-300"
      >
        Shoka
      </a>
    </div>
  </div>
</footer>

<style>
  .footer-link {
    opacity: 0.75;
    position: relative;
  }

  .footer-link:hover {
    opacity: 1;
  }

  .footer-link::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 0;
    height: 1px;
    background: currentColor;
    transition: width 0.3s ease;
  }

  .footer-link:hover::after {
    width: 100%;
  }
</style>
